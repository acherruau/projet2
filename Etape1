[03/01/17]

-> Xen server / pfsense

-> Connaissance des outils à connaitre

Installation de xen server, openXenManager (interface)
Telechargement de l'iso xubuntu

2 machines à créer sur xen: 
-1 machine pfsense=routeur/pare-feu
-1 machine xubuntu  qui intégrera le serveur de gestion des tablettes du chariot.

Telechargement de l'iso xenServer pour l'utilisation sur le pc de test

Telechargement de unebootin pour boot la clé usb avec l'iso xen

Problème rencontré: le pc ne reconnait pas l'iso de la clé lors de son boot.
Essai avec d'autres iso (V6.5): même résultat.
Essai avec une autre clé: l'iso est reconnu --> Problème avec la clé fournie.

Clé faite avec rufus sous Windows.

//Gant sur TomsPlanner
Compte: corentin.thebaudin@laposte.net, mdp: coco72

[04/01/17]

Installation de XenServer sur le pc fourni.

MDP: licpro
config ip statique ou dynamique?
nom: xenserver

Lancement du server: OK

Creation d'une VM Xubuntu à l'aide de l'iso téléchargé au préalable.
Premiers essais: Pas de reconnaissance du contenu de la clé contenant l'iso de xubuntu

Creation d'un template sur le xen server

Tempalte: Other install media --> vm install from other media 
UUID: 574e7c4c-a256-d5b3-25ba-469396b11f8a

VM UUID: d6bd1ae2-99db-5215-042e-10222959340d

xe vm-install template=Other\ install\ media nw-name-label=xubuntuVM
-->UUID renvoyé

OpenXenManager--> Connecté en filaire à la machine

Copie de l'iso xubuntu sur la machine par ssh, copie dans le dossier contenant les iso de xen

Création d'une vm contenant l'iso, avec modification de mémoire (1024mb) et ajout de la ligne suivante:

#xe vm-param-set uuid=[Virtual Machine UUID] HVM-boot-policy=BIOS\ order HVM-boot-params:order=dc

Cette ligne supprime une erreur de bootload

--> 13h30: Xen installé, une VM fonctionnelle (xubuntu).

[05/01/17]

Installation de la vm pfsense (voir sources)

Telechargement de l'iso disponible sur le site pfsense
Ajout de l'iso dans le dossier 

Problème rencontré: la vm se boot a chaque lancement
Solution testée: Suppression de l'iso après le lancement -> KO
--> Appui sur f1 pour lancer pfsense

mdp pfsense web : admin / licpro, xubuntu: mdp=licpro

tools not installed?

Accès à l'interface de gestion pfsense depuis le web: OK (taper l'adresse du serveur pfsense)

[06/01/17 && 09/01/17] 

Rédaction de la page wiki

[10/01/17]

Correction de problèmes techniques / Installation pfSense, réinstall xubuntu

[11/01/17]

Sur Xubuntu, modification du nombre de cpu (a cause de la lenteur):

setxkbmap us -> clavier en azerty

xe vm-param-set platform:cores-per-socket=’4’ uuid=<VM UUID from Step1> -> nombre de cores per processor

xe vm-param-set VCPUs-at-startup='2' uuid=<VM-UUID>  -> nombre de vCpu au départ

xe vm-param-set VCPUs-max='4' -> nombre de vcpu max

Test sur ordi de Corentin -> Pas de crash, si crash -> attente pour relancement

Problème de connexion à l'interface web de pfSense

Solution: ajout d'une gateway (192.168.99.254)

[12/01/17 & 13/01/17]

Recherche connexion tablette

Pas de reconnaissance de l'usb:

lsusb reconnait la connexion, mais pas le server ni la vm.
lscpi, fdisk -l

La tablette ne reconnait pas la connexion non plus.

-> Pilote? nope. Noyau? nope.

Essai Xenserver DDK.iso

[13/02/17]

Recherche connexion tablette.
commandes : lsusb, lscpi, montageduport

Activation du port -> tablette reconnu

Possibilité d'accéder au contenu de la tablette.

Crash de Xubuntu -> Chargement snapshot.

3 ports -> Crash de la VM provenant du port 1d et 1a (surement des ports a ne pas utiliser, interne au systême).

Déblocage du port 45, deux ports usb disponible, les autres ne sont pas reconnus.

Test du script pour tablette, il ne se lance pas -> fonctionnel seulement avec Xubuntu 64 bits.

[14/02/17]

Réinstallation d'une VM Xubuntu 64 bits.

Test du script -> il se lance et fonctionne correctement.

[15/02/16]

Analyse des différents script disponible pour les tablettes.

cf: chapître 'les scripts' rapport_ter_fourmond_noel

Téléchargement des ressources suivantes :
sudo apt-get install android-tools-adb android-tools-fastboot
sudo add-apt-repository ppa:nilarimogard/webupd8

Lancement script scripts.sh -> Téléchargement de l'application 'compagnon' et de tous les scripts.

Création du fichier devices.txt -> Ajout de tous les ID des tablettes

Lancement du script ListeDevice/ListeDeviceConnected -> Alors que la tablette prété (21) est bien connecté et reconnu par l'ordianteur, elle n'est pas afficher à l'exécution du script.

Problème venant peut être de la complétion du mauvais fichiers deviices.txt ?
Non, puisque lors de la complétion de l'autre fichiers devices.txt, toujours pas reconnu.
L'erreur venait du mode débogage usb de la tablette, il doit être activé.

Problème de ping entre les différentes VM -> Plusieurs questions nous viennent:
Problème de réseau (network, NAT...) ? Non, par défaut le réseau est distribué aux autre VM par pont.
Conflit entre PfSense et Xen ? Non.
À quoi sert l'adaptateur usb ethernet ? Uniquement utilisé pour configurer le WAN de PfSense.
Paramétrage réseau de Xen à revoir ? La commande 'route' et son contenu n'est pas clair.

[16/02/16]

Pour trouver le problème, on a chargé le snapshot de la version Xubuntu 32 bits qui arrivait à pinger l'autre VM ainsi que le serveur -> l'adresse MAC de l'interface devait être générer automatiquement alors qu'à la réinstallation de Xubuntu 64 bits, nous avions copier l'adresse MAC de la version 32 bits.

Changement du fichier de configuration PfSense par celui donné par le responsable du projet (mot de passe, domaine...) pour tester si notre système fonctionne bien avec une autre configuration.
-> PfSense crash, réinstallation de la snapshot, snapshot crash aussi;

Réinstallation complète de PfSense, snapshot enrergistré. 

Rendez-vous avec Éric, compte rendu de l'avancement du projet.

Avancement du projet:
Xubuntu, PfSense et Xen communique très bien ensemble.
Possibilité d'avoir accès à deux ports de la machine et donc possibilité d'explorer le contenu d'une tablette ainsi que de lancer les différents scripts donné.

Reste du projet: Borne Wi-Fi à gérer (mais il faut qu'elle soit directement connecté au PfSense pour pouvoir les paramétrer)
Changement de configurtion pfSense (possible mais il faut un accès internet depuis le pfSense).

Problèmes:
Avec PfSense, besoin des bornes Wi-Fi pour pouvoir paramétrer le Wi-Fi avec PfSense.
Avec PfSense, besoin du chariot pour tester la connectivité des hubs et des tablettes.

	Pour commencer, au niveau de la VM Xubuntu, il voudrait des hypothèses/explications sur le fait que la première installation de Xubuntu 64 bits était lente et bugait. (Il demande pas d'explications précises c'est juste "scientifique" comme il dit, il veut notre point de vue sur le problème: dimenssionnement? ram ordinateur? autre? etc.
Au niveau du chariot, il ne sera pas accessible avant le vendredi 03 Mars parce qu'il y a plein de monde qui l'utilise et le jeudi 02 Mars il en a besoin pour un examen. Donc il nous a préter un hub usb 2.0 avec 3 ports pour vérifier si déjà on a bien accès à plusieurs tablettes en même temps.

	Pour ce qui est du wiki, il voudrait un schéma avec toutes les machines, VMs et les liens qu'elles ont entre elles (nottament les interfaces vu qu'on a eut un problème avec celle du PfSense mais aussi afficher toutes nos démarches, hypotèses et solution pour les ports USB et les prochain paragraphe qu'on écrira.

	Pour le problème que l'on a avec PfSense et le changement de configuration avec le fixhier xml qu'il nous a donné, deux solutions s'offre à nous :
- soit, on rend notre machine comme un routeur qui fera un lien direct sur eduroam et après c'est trop brouillon pour que je vous explique mdr mais il m'a parler d'adresse IP  en 10.10.etc.
- ou alors, on lui donne la MAC virtuelle de PfSense et encore une fois je peux pas vous expliquer ce qu'il en fera pcq c'est trop brouillon mdr.

	Pour le Wi-Fi et les bornes, elles seront accessible avec le chariot donc en attendant il va nous préter quelque chose pour tester le Wi-Fi. Enuiste il m'a fait un dessin du système comme il est et les deux bornes USB sont reliées à un commutateur.
Donc si j'ai bien compris, on doit être capable de gérer les tablettes soit par USB soit par Wi-Fi selon les connexions.

Pour finir, la partie dans le wiki avec "Le paramétrage se fait à l'aide du logiciel Apple Airport de l'iPad" nous est complètement inutile, c'était juste une phrase explicative (soit dit en passant extremement mal expliqué) pour nous dire que le paramétrage des bornes Wi-Fi est déjà fait (par lui même) et qu'il l'a réalisé avec l'ipad.
